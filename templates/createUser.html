{% extends "base.html" %}

{% block content %}
<h2>{% if user %}Редактирование{% else %}Создание{% endif %} пользователя</h2>
<form method="POST">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
    {% if not user %}
    <div class="mb-3">
        <label class="form-label">Логин</label>
        <input type="text" 
               name="login" 
               class="form-control {% if errors.login %}is-invalid{% endif %}"
               value="{{ form_data.login }}">
        {% for error in errors.login %}
        <div class="invalid-feedback">{{ error }}</div>
        {% endfor %}
    </div>
    <div class="mb-3">
        <label class="form-label">Пароль</label>
        <input type="password" 
               name="password" 
               class="form-control {% if errors.password %}is-invalid{% endif %}">
        {% for error in errors.password %}
        <div class="invalid-feedback">{{ error }}</div>
        {% endfor %}
    </div>
    {% endif %}
    
    <div class="mb-3">
        <label class="form-label">Фамилия</label>
        <input type="text" 
               name="last_name" 
               class="form-control {% if errors.names %}is-invalid{% endif %}"
               value="{{ form_data.last_name }}">
    </div>
    <div class="mb-3">
        <label class="form-label">Имя*</label>
        <input type="text" 
               name="first_name" 
               class="form-control {% if errors.names %}is-invalid{% endif %}"
               value="{{ form_data.first_name }}"
               required>
        {% for error in errors.names %}
        <div class="invalid-feedback">{{ error }}</div>
        {% endfor %}
    </div>
    

    <div class="mb-3">
        <label class="form-label">Роль</label>
        <select name="role_id" class="form-select">
            <option value="">-- Без роли --</option>
            {% for role in roles %}
            <option value="{{ role.id }}" 
                {% if user and user.role_id == role.id %}selected
                {% elif request.form.role_id == role.id|string %}selected{% endif %}>
                {{ role.name }}
            </option>
            {% endfor %}
        </select>
    </div>
    
    <button type="submit" class="btn btn-primary">Сохранить</button>
    <a href="{{ url_for('user_list') }}" class="btn btn-secondary">Отмена</a>
</form>
{% endblock %}